<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fan Deck - Smooth Shuffle + Spread</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .card {
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .card-inner {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-face {
            backface-visibility: hidden;
        }

        .card-back {
            transform: rotateY(180deg);
        }

        .card-enter {
            opacity: 0;
            transform: translateY(60px) scale(0.9);
        }

        .card-enter-active {
            opacity: 1;
            transform: translateY(0) scale(1);
            transition: all 0.6s ease-out;
        }

        .smooth-transform {
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-100 to-purple-200 flex flex-col items-center justify-center gap-6"
    x-data="deckController" x-init="init()">

    <div x-show="activeCard" x-transition.opacity class="fixed inset-0 bg-black/10 backdrop-blur-sm z-50" @click="removeCard()"></div>
    <!-- Deck -->
    <div x-ref="deck" class="relative w-[900px] h-[300px] flex items-end justify-center">
        <template x-for="(card, index) in cards" :key="card.id">
            <div x-init="$el.classList.add('card-enter'); setTimeout(() => $el.classList.add('card-enter-active'), index * 80 + 200)"
                class="card absolute bottom-0 w-32 h-48 rounded-xl shadow-lg border border-gray-200 smooth-transform cursor-pointer"
                :class="{'flipped': activeCard === card.id}" :style="getStyle(index, card.id)"
                @click="toggleCard(card.id)">
                <div class="card-inner w-full h-full relative">
                    <!-- Front -->
                    <div
                        class="card-face absolute inset-0 bg-white rounded-xl flex items-center justify-center text-gray-700 text-xl font-semibold">
                    </div>

                    <!-- Back -->
                    <div
                        class="card-face card-back absolute inset-0 bg-blue-500 rounded-xl flex items-center justify-center text-white text-lg font-semibold">
                        Revealed <span x-text="card.id"></span>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- Toggle Button -->
    <button class="px-6 py-2 mt-10 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-semibold shadow-md transition"
        @click="toggleSpread()">
        üÉè shuffle
    </button>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('deckController', () => ({
                cards: Array.from({ length: 15 }, (_, i) => ({ id: i + 1 })),
                activeCard: null,
                spread: false,
                animating: false,

                init() {
                    // initial spread animation
                    setTimeout(() => this.spread = true, 300);
                },

                removeCard(){
                    this.activeCard = null;
                },

                toggleCard(id) {
                    if (this.animating) return;
                    // If same card clicked, close it
                    this.activeCard = this.activeCard === id ? null : id;
                },

                async toggleSpread() {
                    if (this.animating) return;
                    this.animating = true;
                    this.activeCard = null;

                    if (this.spread) {
                        this.spread = false;
                        await this.wait(600);
                        this.shuffleCards();
                        await this.wait(400);
                        this.spread = true;
                    } else {
                        this.shuffleCards();
                        await this.wait(300);
                        this.spread = true;
                    }

                    await this.wait(900);
                    this.animating = false;
                },

                shuffleCards() {
                    // Fisher-Yates shuffle
                    for (let i = this.cards.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [this.cards[i], this.cards[j]] = [this.cards[j], this.cards[i]];
                    }
                },

                wait(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                },

                getStyle(index, id) {
                    const isActive = this.activeCard === id;
                    const total = this.cards.length;

                    // If modal view (active card)
                    if (isActive) {
                        return `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -80%) scale(2);
                            z-index: 100;
                            transition: all 0.8s ease-in-out;
                            border: 0px;
                            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                        `;
                    }

                    // Normal deck mode
                    if (!this.spread) {
                        return `
                            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
                            transform:
                                rotate(0deg)
                                translateX(0px)
                                translateY(0px);
                            z-index: ${index};
                            transition: transform 0.6s ease-in-out;
                        `;
                    }

                    // Fan spread positioning
                    const rotation = ((index - total / 2) * 2);
                    const offset = ((index - total / 2) * 24);

                    return `
                        transform:
                            rotate(${rotation}deg)
                            translateX(${offset}px)
                            translateY(0px);
                        z-index: ${index};
                        transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
                    `;
                }
            }));
        });
    </script>


</body>

</html>